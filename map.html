<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>D3 World Map</title>
    <style>
        path {
            stroke: black;
            stroke-width: 0.5px;
            fill: none;
        }

        svg {
            border-color: red;
            border-width: 5px;
            border-style: solid;
        }
    </style>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/topojson.v0.min.js"></script>
</head>

<body>
    <div id="dropdown_container">
        <select id="dropdown_year"></select>
    </div>

    <script type="text/javascript">
        var width = window.innerWidth;
        var height = window.innerHeight;

        var projection = d3.geo.albersUsa()
            .scale(1000)
            .translate([width / 2, height / 2]);

        var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height);

        var path = d3.geo.path()
            .projection(projection);

        var g = svg.append("g");

        d3.json("us-counties-10m.json", function (error, topology) {
            // Load the map once
            g.selectAll("path")
                .data(topojson.object(topology, topology.objects.states)
                    .geometries)
                .enter()
                .append("path")
                .attr("d", path);

            d3.csv("college_cost.csv", function (error, data) {
                var years = d3.set(data.map(function (d) { return d.Year; })).values();

                d3.select("#dropdown_year")
                    .selectAll("option")
                    .data(years)
                    .enter()
                    .append("option")
                    .text(function (d) { return d; })
                    .attr("value", function (d) { return d; });

                d3.select("#dropdown_year").on("change", function () {
                    var curr_year = this.value;

                    var filtered_data = data.filter(function (d) {
                        return d.Year == curr_year && d.Expense == "Fees/Tuition" && d.Type === "Private" && d.Length === "4-year";
                    });

                    var mapping = d3.map();

                    filtered_data.forEach(function (d) {
                        mapping.set(d.State, +d.Value);
                    });

                    var color = d3.scale.linear()
                        .domain([0, d3.max(filtered_data, function (d) { return +d.Value; })])
                        .range(["#f7fbff", "#08306b"]);

                    // Update colors of existing paths based on the filtered data
                    g.selectAll("path")
                        .style("fill", function (d) {
                            var value = mapping.get(d.properties.name) || 0;
                            return color(value);
                        });
                });

                d3.select("#dropdown_year").dispatch("change");
            });
        });
    </script>
</body>

</html>